<link rel="import" href="../bower_components/polymer/polymer-element.html">
<link rel="import" href="../bower_components/iron-ajax/iron-ajax.html">

<dom-module id="slr-ajax">
  <script>
    class SlrAjax extends window.customElements.get('iron-ajax') {
      static get is() { return 'slr-ajax' }

      // intercept unauthorized requests
      generateRequest() {
        let request = super.generateRequest()
        request.completes.catch((rejected) => {
          let error = rejected.request.response.status
          if (error === 401) {
            return this.dispatchEvent(new CustomEvent('slr-authenticate',
                                        {bubbles: true, composed: true})
                                      )
          }
        })
        return request
      }
    }

    window.customElements.define(SlrAjax.is, SlrAjax)
  </script>
</dom-module>
